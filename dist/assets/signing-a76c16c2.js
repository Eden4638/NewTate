import{ap as K,du as q,dv as J,dw as X,dx as Y,dy as Q,dz as T,cP as A,dA as e0,cZ as I,dB as t0,dC as n0,dD as S,cD as M,dE as H,r as _,U as g,x as r0,u as E,X as h,a0 as s0,cr as i0,dF as a0,dG as o0,dH as P,dI as c0,T as y,dJ as C,dK as u0,dL as d0,dM as f0,cT as l0,F,N as R,a6 as D}from"./index-a005ad49.js";import{concatHex as p0}from"./concat-hex-f6252d40.js";import{a as b0}from"./Signature-48d91ea5.js";import{p as O}from"./index-45c08a14.js";import"./send-eip712-transaction-0a5b285e.js";import"./eth_sendRawTransaction-5ae15b91.js";function y0(e,t){const n=typeof t=="string"?{to:t}:t;switch(n.to){case"number":return h0(e,n);case"bigint":return m0(e,n);case"boolean":return g0(e,n);case"string":return w0(e,n);default:return K(e,n)}}function m0(e,t={}){return q(e,t)}function g0(e,t={}){return J(e,t)}function h0(e,t={}){return X(e,t)}function w0(e,t={}){return Y(e,t)}function v0(e){for(const t of e)if(typeof t!="string")return!1;return!0}function A0(e){return v0(e)?Q(e):e}function x(e){let t=!0,n="",r=0,s="",a=!1;for(let i=0;i<e.length;i++){const o=e[i];if(["(",")",","].includes(o)&&(t=!0),o==="("&&r++,o===")"&&r--,!!t){if(r===0){if(o===" "&&["event","function","error",""].includes(s))s="";else if(s+=o,o===")"){a=!0;break}continue}if(o===" "){e[i-1]!==","&&n!==","&&n!==",("&&(n="",t=!1);continue}s+=o,n+=o}}if(!a)throw new A("Unable to normalize signature.");return s}function $(e,t){const n=typeof e,r=t.type;switch(r){case"address":return T(e,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return r==="tuple"&&"components"in t?Object.values(t.components).every((s,a)=>$(Object.values(e)[a],s)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(r)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(r)?n==="string"||e instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(r)?Array.isArray(e)&&e.every(s=>$(s,{...t,type:r.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function U(e,t,n){for(const r in e){const s=e[r],a=t[r];if(s.type==="tuple"&&a.type==="tuple"&&"components"in s&&"components"in a)return U(s.components,a.components,n[r]);const i=[s.type,a.type];if((()=>i.includes("address")&&i.includes("bytes20")?!0:i.includes("address")&&i.includes("string")?T(n[r],{strict:!1}):i.includes("address")&&i.includes("bytes")?T(n[r],{strict:!1}):!1)())return i}}function E0(e,t,n){const{args:r=[],prepare:s=!0}=n??{},a=e0(t,{strict:!1}),i=e.filter(c=>a?c.type==="function"||c.type==="error"?L(c)===I(t,0,4):c.type==="event"?m(c)===t:!1:"name"in c&&c.name===t);if(i.length===0)throw new w({name:t});if(i.length===1)return{...i[0],...s?{hash:m(i[0])}:{}};let o;for(const c of i){if(!("inputs"in c))continue;if(!r||r.length===0){if(!c.inputs||c.inputs.length===0)return{...c,...s?{hash:m(c)}:{}};continue}if(!c.inputs||c.inputs.length===0||c.inputs.length!==r.length)continue;if(r.every((d,p)=>{const l="inputs"in c&&c.inputs[p];return l?$(d,l):!1})){if(o&&"inputs"in o&&o.inputs){const d=U(c.inputs,o.inputs,r);if(d)throw new S0({abiItem:c,type:d[0]},{abiItem:o,type:d[1]})}o=c}}const f=(()=>{if(o)return o;const[c,...u]=i;return{...c,overloads:u}})();if(!f)throw new w({name:t});return{...f,...s?{hash:m(f)}:{}}}function L(e){return I(m(e),0,4)}function T0(e){const t=(()=>typeof e=="string"?e:S(e))();return x(t)}function m(e){return typeof e!="string"&&"hash"in e&&e.hash?e.hash:t0(n0(T0(e)))}class S0 extends A{constructor(t,n){super("Found ambiguous types in overloaded ABI Items.",{metaMessages:[`\`${t.type}\` in \`${x(S(t.abiItem))}\`, and`,`\`${n.type}\` in \`${x(S(n.abiItem))}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.AmbiguityError"})}}class w extends A{constructor({name:t,data:n,type:r="item"}){const s=(()=>t?` with name "${t}"`:n?` with data "${n}"`:"")();super(`ABI ${r}${s} not found.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.NotFoundError"})}}function _0(e,t){var s;const{bytecode:n,args:r}=t;return M(n,(s=e.inputs)!=null&&s.length&&(r!=null&&r.length)?H(e.inputs,r):"0x")}function D0(e){const t=e.find(n=>n.type==="constructor");if(!t)throw new w({name:"constructor"});return t}function x0(e,...t){const{overloads:n}=e,r=n?N([e,...n],e.name,{args:t[0]}):e,s=$0(r),a=t.length>0?H(r.inputs,t[0]):void 0;return a?M(s,a):s}function N(e,t,n){const r=E0(e,t,n);if(r.type!=="function")throw new w({name:t,type:"function"});return r}function $0(e){return L(e)}const I0="0x6492649264926492649264926492649264926492649264926492649264926492",V0="0x608060405234801561001057600080fd5b5060405161069438038061069483398101604081905261002f9161051e565b600061003c848484610048565b9050806000526001601ff35b60007f64926492649264926492649264926492649264926492649264926492649264926100748361040c565b036101e7576000606080848060200190518101906100929190610577565b60405192955090935091506000906001600160a01b038516906100b69085906105dd565b6000604051808303816000865af19150503d80600081146100f3576040519150601f19603f3d011682016040523d82523d6000602084013e6100f8565b606091505b50509050876001600160a01b03163b60000361016057806101605760405162461bcd60e51b815260206004820152601e60248201527f5369676e617475726556616c696461746f723a206465706c6f796d656e74000060448201526064015b60405180910390fd5b604051630b135d3f60e11b808252906001600160a01b038a1690631626ba7e90610190908b9087906004016105f9565b602060405180830381865afa1580156101ad573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101d19190610633565b6001600160e01b03191614945050505050610405565b6001600160a01b0384163b1561027a57604051630b135d3f60e11b808252906001600160a01b03861690631626ba7e9061022790879087906004016105f9565b602060405180830381865afa158015610244573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102689190610633565b6001600160e01b031916149050610405565b81516041146102df5760405162461bcd60e51b815260206004820152603a602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e6174757265206c656e6774680000000000006064820152608401610157565b6102e7610425565b5060208201516040808401518451859392600091859190811061030c5761030c61065d565b016020015160f81c9050601b811480159061032b57508060ff16601c14155b1561038c5760405162461bcd60e51b815260206004820152603b602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e617475726520762076616c756500000000006064820152608401610157565b60408051600081526020810180835289905260ff83169181019190915260608101849052608081018390526001600160a01b0389169060019060a0016020604051602081039080840390855afa1580156103ea573d6000803e3d6000fd5b505050602060405103516001600160a01b0316149450505050505b9392505050565b600060208251101561041d57600080fd5b508051015190565b60405180606001604052806003906020820280368337509192915050565b6001600160a01b038116811461045857600080fd5b50565b634e487b7160e01b600052604160045260246000fd5b60005b8381101561048c578181015183820152602001610474565b50506000910152565b600082601f8301126104a657600080fd5b81516001600160401b038111156104bf576104bf61045b565b604051601f8201601f19908116603f011681016001600160401b03811182821017156104ed576104ed61045b565b60405281815283820160200185101561050557600080fd5b610516826020830160208701610471565b949350505050565b60008060006060848603121561053357600080fd5b835161053e81610443565b6020850151604086015191945092506001600160401b0381111561056157600080fd5b61056d86828701610495565b9150509250925092565b60008060006060848603121561058c57600080fd5b835161059781610443565b60208501519093506001600160401b038111156105b357600080fd5b6105bf86828701610495565b604086015190935090506001600160401b0381111561056157600080fd5b600082516105ef818460208701610471565b9190910192915050565b828152604060208201526000825180604084015261061e816060850160208701610471565b601f01601f1916919091016060019392505050565b60006020828403121561064557600080fd5b81516001600160e01b03198116811461040557600080fd5b634e487b7160e01b600052603260045260246000fdfe5369676e617475726556616c696461746f72237265636f7665725369676e6572",B0=[{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],outputs:[{type:"bool"}],stateMutability:"nonpayable",type:"function",name:"isValidSig"}];function P0(e){if(I(e,-32)!==I0)throw new H0(e)}function M0(e){try{return P0(e),!0}catch{return!1}}class H0 extends A{constructor(t){super(`Value \`${t}\` is an invalid ERC-6492 wrapped signature.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"WrappedSignature.InvalidWrappedSignatureError"})}}const C0="0x1626ba7e",F0=[{type:"bytes32",name:"hash"},{type:"bytes",name:"signature"}],R0=[{type:"bytes4"}];async function O0(e){return _({contract:e.contract,method:[C0,F0,R0],params:[e.hash,e.signature]})}const U0="0x6492649264926492649264926492649264926492649264926492649264926492";function V({address:e,data:t,signature:n}){return p0([g([{type:"address"},{type:"bytes"},{type:"bytes"}],[e,t,n]),U0])}const L0="0xfB688330379976DA81eB64Fe4BF50d7401763B9C";async function k({hash:e,signature:t,address:n,client:r,chain:s,accountFactory:a}){const i=(()=>{if(r0(t))return t;if(typeof t=="object"&&"r"in t&&"s"in t)return b0(t);if(t instanceof Uint8Array)return y0(t,"hex");throw new Error(`Invalid signature type for signature ${t}: ${typeof t}`)})();if(await E(h({address:n,client:r,chain:s}))&&await v({hash:e,signature:i,contract:h({chain:s,address:n,client:r})}).catch(b=>(console.error("Error verifying EIP-1271 signature",b),!1)))return!0;const f=await(async()=>!a||M0(i)?i:V({address:a.address,data:a.verificationCalldata,signature:i}))();let c;const u=await s0(s),d=A0(B0);if(u)c={to:L0,data:x0(N(d,"isValidSig"),[n,e,f])};else{const l=D0(d);c={data:_0(l,{args:[n,e,f],bytecode:V0})}}const p=i0({chain:s,client:r});try{const l=await a0(p,c);return o0(l)}catch{return!!await v({hash:e,signature:i,contract:h({chain:s,address:n,client:r})}).catch(b=>(console.error("Error verifying EIP-1271 signature",b),!1))}}const N0="0x1626ba7e";async function v({hash:e,signature:t,contract:n}){try{return await O0({hash:e,signature:t,contract:n})===N0}catch(r){return console.error("Error verifying EIP-1271 signature",r),!1}}const k0=`Ethereum Signed Message:
`;function j0(e,t){const n=(()=>typeof e=="string"?P(e):e.raw instanceof Uint8Array?e.raw:c0(e.raw))(),r=P(`${k0}${n.length}`);return y(C(r,n),t)}function z0(e){const{domain:t={},message:n,primaryType:r}=e,s={EIP712Domain:u0(t),...e.types};d0({domain:t,message:n,primaryType:r,types:s});const a=["0x1901"];if(t&&a.push(f0({domain:t,types:s})),r!=="EIP712Domain"){const i=(()=>{const o=j({data:n,primaryType:r,types:s});return y(o)})();a.push(i)}return y(C(...a.map(i=>l0(i))))}function j({data:e,primaryType:t,types:n}){const r=[{type:"bytes32"}],s=[G0({primaryType:t,types:n})];if(!n[t])throw new Error("Invalid types");for(const a of n[t]){const[i,o]=G({types:n,name:a.name,type:a.type,value:e[a.name]});r.push(i),s.push(o)}return g(r,s)}function G0({primaryType:e,types:t}){const n=F(W0({primaryType:e,types:t}));return y(n)}function W0({primaryType:e,types:t}){let n="";const r=z({primaryType:e,types:t});r.delete(e);const s=[e,...Array.from(r).sort()];for(const a of s){if(!t[a])throw new Error("Invalid types");n+=`${a}(${t[a].map(({name:i,type:o})=>`${o} ${i}`).join(",")})`}return n}function z({primaryType:e,types:t},n=new Set){const r=e.match(/^\w*/u),s=r==null?void 0:r[0];if(n.has(s)||t[s]===void 0)return n;n.add(s);for(const a of t[s])z({primaryType:a.type,types:t},n);return n}function G({types:e,name:t,type:n,value:r}){if(e[n]!==void 0)return[{type:"bytes32"},y(j({data:r,primaryType:n,types:e}))];if(n==="bytes")return r=`0x${(r.length%2?"0":"")+r.slice(2)}`,[{type:"bytes32"},y(r)];if(n==="string")return[{type:"bytes32"},y(F(r))];if(n.lastIndexOf("]")===n.length-1){const s=n.slice(0,n.lastIndexOf("[")),a=r.map(i=>G({name:t,type:s,types:e,value:i}));return[{type:"bytes32"},y(g(a.map(([i])=>i),a.map(([,i])=>i)))]}return[{type:n},r]}async function te({accountContract:e,factoryContract:t,options:n,message:r}){var f,c;const s=j0(r),a=await W({factoryContract:t,accountContract:e,originalMsgHash:s});let i;if(a){const u=g([{type:"bytes32"}],[s]);i=await n.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:n.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:u}})}else i=await n.personalAccount.signMessage({message:r});if(await E(e)){if(await v({hash:s,signature:i,contract:e}))return i;throw new Error("Failed to verify signature")}else{const u=O({factoryContract:t,adminAddress:n.personalAccount.address,accountSalt:(f=n.overrides)==null?void 0:f.accountSalt,createAccountOverride:(c=n.overrides)==null?void 0:c.createAccount});if(!u)throw new Error("Create account override not provided");const d=await R(u),p=V({address:t.address,data:d,signature:i});if(await k({hash:s,signature:p,address:e.address,chain:e.chain,client:e.client}))return p;throw new Error("Unable to verify ERC-6492 signature after signing.")}}async function ne({accountContract:e,factoryContract:t,options:n,typedData:r}){var c,u,d,p,l;if(((u=(c=r.domain)==null?void 0:c.verifyingContract)==null?void 0:u.toLowerCase())===((d=e.address)==null?void 0:d.toLowerCase()))return n.personalAccount.signTypedData(r);const a=z0(r),i=await W({factoryContract:t,accountContract:e,originalMsgHash:a});let o;if(i){const b=g([{type:"bytes32"}],[a]);o=await n.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:n.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:b}})}else o=await n.personalAccount.signTypedData(r);if(await E(e)){if(await v({hash:a,signature:o,contract:e}))return o;throw new Error("Failed to verify signature")}else{const b=O({factoryContract:t,adminAddress:n.personalAccount.address,accountSalt:(p=n.overrides)==null?void 0:p.accountSalt,createAccountOverride:(l=n.overrides)==null?void 0:l.createAccount});if(!b)throw new Error("Create account override not provided");const Z=await R(b),B=V({address:t.address,data:Z,signature:o});if(await k({hash:a,signature:B,address:e.address,chain:e.chain,client:e.client}))return B;throw new Error("Unable to verify signature on smart account, please make sure the admin wallet has permissions and the signature is valid.")}}async function Z0(e){const{accountContract:t}=e,n=Date.now(),r=6e4,{isContractDeployed:s}=await D(()=>import("./index-a005ad49.js").then(i=>i.e7),["assets/index-a005ad49.js","assets/index-fae58ef4.css"]);let a=await s(t);for(;!a;){if(Date.now()-n>r)throw new Error("Timeout: Smart account deployment not confirmed after 1 minute");await new Promise(i=>setTimeout(i,500)),a=await s(t)}}async function W({factoryContract:e,accountContract:t,originalMsgHash:n}){try{const r=await _({contract:e,method:"function accountImplementation() public view returns (address)"});return await _({contract:h({address:r,chain:t.chain,client:t.client}),method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[n]}).then(a=>a!=="0x").catch(()=>!1)}catch{return!1}}async function re(e){const{chain:t,client:n,smartAccount:r,accountContract:s}=e;if(await E(s))return;const[{sendTransaction:i},{prepareTransaction:o}]=await Promise.all([D(()=>import("./index-a005ad49.js").then(u=>u.e9),["assets/index-a005ad49.js","assets/index-fae58ef4.css"]),D(()=>import("./index-a005ad49.js").then(u=>u.e8),["assets/index-a005ad49.js","assets/index-fae58ef4.css"])]),f=o({client:n,chain:t,to:s.address,value:0n,gas:50000n}),c=await i({transaction:f,account:r});return await Z0({accountContract:s}),c}export{Z0 as confirmContractDeployment,re as deploySmartAccount,te as smartAccountSignMessage,ne as smartAccountSignTypedData};
