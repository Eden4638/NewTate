import{dN as X,ck as yt,dO as Xe,dP as je,dQ as _e,dR as wt,dS as bt,dT as Pt,dU as Ct,dV as It,dW as Et,dX as Ot,dY as ue,dZ as W,d_ as At,d$ as Q,e0 as $t,e1 as Ye,e2 as oe,e3 as $,e4 as jt,e5 as Ze,e6 as He,a6 as _t}from"./index-a005ad49.js";var fe={exports:{}};(function(s,e){var t=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof X<"u"&&X,i=function(){function o(){this.fetch=!1,this.DOMException=t.DOMException}return o.prototype=t,new o}();(function(o){(function(a){var c=typeof o<"u"&&o||typeof self<"u"&&self||typeof X<"u"&&X||{},p={searchParams:"URLSearchParams"in c,iterable:"Symbol"in c&&"iterator"in Symbol,blob:"FileReader"in c&&"Blob"in c&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in c,arrayBuffer:"ArrayBuffer"in c};function g(n){return n&&DataView.prototype.isPrototypeOf(n)}if(p.arrayBuffer)var y=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],_=ArrayBuffer.isView||function(n){return n&&y.indexOf(Object.prototype.toString.call(n))>-1};function v(n){if(typeof n!="string"&&(n=String(n)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(n)||n==="")throw new TypeError('Invalid character in header field name: "'+n+'"');return n.toLowerCase()}function P(n){return typeof n!="string"&&(n=String(n)),n}function ie(n){var h={next:function(){var l=n.shift();return{done:l===void 0,value:l}}};return p.iterable&&(h[Symbol.iterator]=function(){return h}),h}function w(n){this.map={},n instanceof w?n.forEach(function(h,l){this.append(l,h)},this):Array.isArray(n)?n.forEach(function(h){if(h.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+h.length);this.append(h[0],h[1])},this):n&&Object.getOwnPropertyNames(n).forEach(function(h){this.append(h,n[h])},this)}w.prototype.append=function(n,h){n=v(n),h=P(h);var l=this.map[n];this.map[n]=l?l+", "+h:h},w.prototype.delete=function(n){delete this.map[v(n)]},w.prototype.get=function(n){return n=v(n),this.has(n)?this.map[n]:null},w.prototype.has=function(n){return this.map.hasOwnProperty(v(n))},w.prototype.set=function(n,h){this.map[v(n)]=P(h)},w.prototype.forEach=function(n,h){for(var l in this.map)this.map.hasOwnProperty(l)&&n.call(h,this.map[l],l,this)},w.prototype.keys=function(){var n=[];return this.forEach(function(h,l){n.push(l)}),ie(n)},w.prototype.values=function(){var n=[];return this.forEach(function(h){n.push(h)}),ie(n)},w.prototype.entries=function(){var n=[];return this.forEach(function(h,l){n.push([l,h])}),ie(n)},p.iterable&&(w.prototype[Symbol.iterator]=w.prototype.entries);function re(n){if(!n._noBody){if(n.bodyUsed)return Promise.reject(new TypeError("Already read"));n.bodyUsed=!0}}function Ee(n){return new Promise(function(h,l){n.onload=function(){h(n.result)},n.onerror=function(){l(n.error)}})}function pt(n){var h=new FileReader,l=Ee(h);return h.readAsArrayBuffer(n),l}function lt(n){var h=new FileReader,l=Ee(h),f=/charset=([A-Za-z0-9_-]+)/.exec(n.type),m=f?f[1]:"utf-8";return h.readAsText(n,m),l}function dt(n){for(var h=new Uint8Array(n),l=new Array(h.length),f=0;f<h.length;f++)l[f]=String.fromCharCode(h[f]);return l.join("")}function Oe(n){if(n.slice)return n.slice(0);var h=new Uint8Array(n.byteLength);return h.set(new Uint8Array(n)),h.buffer}function Ae(){return this.bodyUsed=!1,this._initBody=function(n){this.bodyUsed=this.bodyUsed,this._bodyInit=n,n?typeof n=="string"?this._bodyText=n:p.blob&&Blob.prototype.isPrototypeOf(n)?this._bodyBlob=n:p.formData&&FormData.prototype.isPrototypeOf(n)?this._bodyFormData=n:p.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)?this._bodyText=n.toString():p.arrayBuffer&&p.blob&&g(n)?(this._bodyArrayBuffer=Oe(n.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):p.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(n)||_(n))?this._bodyArrayBuffer=Oe(n):this._bodyText=n=Object.prototype.toString.call(n):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof n=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):p.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},p.blob&&(this.blob=function(){var n=re(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var n=re(this);return n||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(p.blob)return this.blob().then(pt);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var n=re(this);if(n)return n;if(this._bodyBlob)return lt(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(dt(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},p.formData&&(this.formData=function(){return this.text().then(mt)}),this.json=function(){return this.text().then(JSON.parse)},this}var ut=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function ft(n){var h=n.toUpperCase();return ut.indexOf(h)>-1?h:n}function H(n,h){if(!(this instanceof H))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');h=h||{};var l=h.body;if(n instanceof H){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url,this.credentials=n.credentials,h.headers||(this.headers=new w(n.headers)),this.method=n.method,this.mode=n.mode,this.signal=n.signal,!l&&n._bodyInit!=null&&(l=n._bodyInit,n.bodyUsed=!0)}else this.url=String(n);if(this.credentials=h.credentials||this.credentials||"same-origin",(h.headers||!this.headers)&&(this.headers=new w(h.headers)),this.method=ft(h.method||this.method||"GET"),this.mode=h.mode||this.mode||null,this.signal=h.signal||this.signal||function(){if("AbortController"in c){var d=new AbortController;return d.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&l)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(l),(this.method==="GET"||this.method==="HEAD")&&(h.cache==="no-store"||h.cache==="no-cache")){var f=/([?&])_=[^&]*/;if(f.test(this.url))this.url=this.url.replace(f,"$1_="+new Date().getTime());else{var m=/\?/;this.url+=(m.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}H.prototype.clone=function(){return new H(this,{body:this._bodyInit})};function mt(n){var h=new FormData;return n.trim().split("&").forEach(function(l){if(l){var f=l.split("="),m=f.shift().replace(/\+/g," "),d=f.join("=").replace(/\+/g," ");h.append(decodeURIComponent(m),decodeURIComponent(d))}}),h}function vt(n){var h=new w,l=n.replace(/\r?\n[\t ]+/g," ");return l.split("\r").map(function(f){return f.indexOf(`
`)===0?f.substr(1,f.length):f}).forEach(function(f){var m=f.split(":"),d=m.shift().trim();if(d){var K=m.join(":").trim();try{h.append(d,K)}catch(ae){console.warn("Response "+ae.message)}}}),h}Ae.call(H.prototype);function A(n,h){if(!(this instanceof A))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(h||(h={}),this.type="default",this.status=h.status===void 0?200:h.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=h.statusText===void 0?"":""+h.statusText,this.headers=new w(h.headers),this.url=h.url||"",this._initBody(n)}Ae.call(A.prototype),A.prototype.clone=function(){return new A(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new w(this.headers),url:this.url})},A.error=function(){var n=new A(null,{status:200,statusText:""});return n.ok=!1,n.status=0,n.type="error",n};var gt=[301,302,303,307,308];A.redirect=function(n,h){if(gt.indexOf(h)===-1)throw new RangeError("Invalid status code");return new A(null,{status:h,headers:{location:n}})},a.DOMException=c.DOMException;try{new a.DOMException}catch{a.DOMException=function(h,l){this.message=h,this.name=l;var f=Error(h);this.stack=f.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function ne(n,h){return new Promise(function(l,f){var m=new H(n,h);if(m.signal&&m.signal.aborted)return f(new a.DOMException("Aborted","AbortError"));var d=new XMLHttpRequest;function K(){d.abort()}d.onload=function(){var b={statusText:d.statusText,headers:vt(d.getAllResponseHeaders()||"")};m.url.indexOf("file://")===0&&(d.status<200||d.status>599)?b.status=200:b.status=d.status,b.url="responseURL"in d?d.responseURL:b.headers.get("X-Request-URL");var S="response"in d?d.response:d.responseText;setTimeout(function(){l(new A(S,b))},0)},d.onerror=function(){setTimeout(function(){f(new TypeError("Network request failed"))},0)},d.ontimeout=function(){setTimeout(function(){f(new TypeError("Network request timed out"))},0)},d.onabort=function(){setTimeout(function(){f(new a.DOMException("Aborted","AbortError"))},0)};function ae(b){try{return b===""&&c.location.href?c.location.href:b}catch{return b}}if(d.open(m.method,ae(m.url),!0),m.credentials==="include"?d.withCredentials=!0:m.credentials==="omit"&&(d.withCredentials=!1),"responseType"in d&&(p.blob?d.responseType="blob":p.arrayBuffer&&(d.responseType="arraybuffer")),h&&typeof h.headers=="object"&&!(h.headers instanceof w||c.Headers&&h.headers instanceof c.Headers)){var $e=[];Object.getOwnPropertyNames(h.headers).forEach(function(b){$e.push(v(b)),d.setRequestHeader(b,P(h.headers[b]))}),m.headers.forEach(function(b,S){$e.indexOf(S)===-1&&d.setRequestHeader(S,b)})}else m.headers.forEach(function(b,S){d.setRequestHeader(S,b)});m.signal&&(m.signal.addEventListener("abort",K),d.onreadystatechange=function(){d.readyState===4&&m.signal.removeEventListener("abort",K)}),d.send(typeof m._bodyInit>"u"?null:m._bodyInit)})}return ne.polyfill=!0,c.fetch||(c.fetch=ne,c.Headers=w,c.Request=H,c.Response=A),a.Headers=w,a.Request=H,a.Response=A,a.fetch=ne,Object.defineProperty(a,"__esModule",{value:!0}),a})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var r=t.fetch?t:i;e=r.fetch,e.default=r.fetch,e.fetch=r.fetch,e.Headers=r.Headers,e.Request=r.Request,e.Response=r.Response,s.exports=e})(fe,fe.exports);var Ht=fe.exports;const Se=yt(Ht);var St=Object.defineProperty,Dt=Object.defineProperties,qt=Object.getOwnPropertyDescriptors,De=Object.getOwnPropertySymbols,Nt=Object.prototype.hasOwnProperty,Tt=Object.prototype.propertyIsEnumerable,qe=(s,e,t)=>e in s?St(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ne=(s,e)=>{for(var t in e||(e={}))Nt.call(e,t)&&qe(s,t,e[t]);if(De)for(var t of De(e))Tt.call(e,t)&&qe(s,t,e[t]);return s},Te=(s,e)=>Dt(s,qt(e));const Rt={Accept:"application/json","Content-Type":"application/json"},Mt="POST",Re={headers:Rt,method:Mt},Me=10;class j{constructor(e,t=!1){if(this.url=e,this.disableProviderPing=t,this.events=new Xe.EventEmitter,this.isAvailable=!1,this.registering=!1,!je(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const t=_e(e),i=await(await Se(this.url,Te(Ne({},Re),{body:t}))).json();this.onPayload({data:i})}catch(t){this.onError(e.id,t)}}async register(e=this.url){if(!je(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,r)=>{this.events.once("register_error",o=>{this.resetMaxListeners(),r(o)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return r(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const t=_e({id:1,jsonrpc:"2.0",method:"test",params:[]});await Se(e,Te(Ne({},Re),{body:t}))}this.onOpen()}catch(t){const i=this.parseError(t);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?wt(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),r=i.message||i.toString(),o=bt(e,r);this.events.emit("payload",o)}parseError(e,t=this.url){return Pt(e,t,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Me&&this.events.setMaxListeners(Me)}}const Ue="error",Ut="wss://relay.walletconnect.org",xt="wc",Bt="universal_provider",Y=`${xt}@2:${Bt}:`,et="https://rpc.walletconnect.org/v1/",G="generic",Ft=`${et}bundler`,O={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function Lt(){}function Pe(s){return s==null||typeof s!="object"&&typeof s!="function"}function Ce(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function kt(s){if(Pe(s))return s;if(Array.isArray(s)||Ce(s)||s instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&s instanceof SharedArrayBuffer)return s.slice(0);const e=Object.getPrototypeOf(s),t=e.constructor;if(s instanceof Date||s instanceof Map||s instanceof Set)return new t(s);if(s instanceof RegExp){const i=new t(s);return i.lastIndex=s.lastIndex,i}if(s instanceof DataView)return new t(s.buffer.slice(0));if(s instanceof Error){const i=new t(s.message);return i.stack=s.stack,i.name=s.name,i.cause=s.cause,i}if(typeof File<"u"&&s instanceof File)return new t([s],s.name,{type:s.type,lastModified:s.lastModified});if(typeof s=="object"){const i=Object.create(e);return Object.assign(i,s)}return s}function xe(s){return typeof s=="object"&&s!==null}function tt(s){return Object.getOwnPropertySymbols(s).filter(e=>Object.prototype.propertyIsEnumerable.call(s,e))}function st(s){return s==null?s===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(s)}const zt="[object RegExp]",it="[object String]",rt="[object Number]",nt="[object Boolean]",at="[object Arguments]",Gt="[object Symbol]",Jt="[object Date]",Vt="[object Map]",Qt="[object Set]",Wt="[object Array]",Kt="[object ArrayBuffer]",Xt="[object Object]",Yt="[object DataView]",Zt="[object Uint8Array]",es="[object Uint8ClampedArray]",ts="[object Uint16Array]",ss="[object Uint32Array]",is="[object Int8Array]",rs="[object Int16Array]",ns="[object Int32Array]",as="[object Float32Array]",os="[object Float64Array]";function cs(s,e){return V(s,void 0,s,new Map,e)}function V(s,e,t,i=new Map,r=void 0){const o=r==null?void 0:r(s,e,t,i);if(o!=null)return o;if(Pe(s))return s;if(i.has(s))return i.get(s);if(Array.isArray(s)){const a=new Array(s.length);i.set(s,a);for(let c=0;c<s.length;c++)a[c]=V(s[c],c,t,i,r);return Object.hasOwn(s,"index")&&(a.index=s.index),Object.hasOwn(s,"input")&&(a.input=s.input),a}if(s instanceof Date)return new Date(s.getTime());if(s instanceof RegExp){const a=new RegExp(s.source,s.flags);return a.lastIndex=s.lastIndex,a}if(s instanceof Map){const a=new Map;i.set(s,a);for(const[c,p]of s)a.set(c,V(p,c,t,i,r));return a}if(s instanceof Set){const a=new Set;i.set(s,a);for(const c of s)a.add(V(c,void 0,t,i,r));return a}if(typeof Buffer<"u"&&Buffer.isBuffer(s))return s.subarray();if(Ce(s)){const a=new(Object.getPrototypeOf(s)).constructor(s.length);i.set(s,a);for(let c=0;c<s.length;c++)a[c]=V(s[c],c,t,i,r);return a}if(s instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&s instanceof SharedArrayBuffer)return s.slice(0);if(s instanceof DataView){const a=new DataView(s.buffer.slice(0),s.byteOffset,s.byteLength);return i.set(s,a),D(a,s,t,i,r),a}if(typeof File<"u"&&s instanceof File){const a=new File([s],s.name,{type:s.type});return i.set(s,a),D(a,s,t,i,r),a}if(s instanceof Blob){const a=new Blob([s],{type:s.type});return i.set(s,a),D(a,s,t,i,r),a}if(s instanceof Error){const a=new s.constructor;return i.set(s,a),a.message=s.message,a.name=s.name,a.stack=s.stack,a.cause=s.cause,D(a,s,t,i,r),a}if(typeof s=="object"&&hs(s)){const a=Object.create(Object.getPrototypeOf(s));return i.set(s,a),D(a,s,t,i,r),a}return s}function D(s,e,t=s,i,r){const o=[...Object.keys(e),...tt(e)];for(let a=0;a<o.length;a++){const c=o[a],p=Object.getOwnPropertyDescriptor(s,c);(p==null||p.writable)&&(s[c]=V(e[c],c,t,i,r))}}function hs(s){switch(st(s)){case at:case Wt:case Kt:case Yt:case nt:case Jt:case as:case os:case is:case rs:case ns:case Vt:case rt:case Xt:case zt:case Qt:case it:case Gt:case Zt:case es:case ts:case ss:return!0;default:return!1}}function ps(s,e){return cs(s,(t,i,r,o)=>{const a=e==null?void 0:e(t,i,r,o);if(a!=null)return a;if(typeof s=="object")switch(Object.prototype.toString.call(s)){case rt:case it:case nt:{const c=new s.constructor(s==null?void 0:s.valueOf());return D(c,s),c}case at:{const c={};return D(c,s),c.length=s.length,c[Symbol.iterator]=s[Symbol.iterator],c}default:return}})}function Be(s){return ps(s)}function Fe(s){return s!==null&&typeof s=="object"&&st(s)==="[object Arguments]"}function ls(s){return Ce(s)}function ds(s){var t;if(typeof s!="object"||s==null)return!1;if(Object.getPrototypeOf(s)===null)return!0;if(Object.prototype.toString.call(s)!=="[object Object]"){const i=s[Symbol.toStringTag];return i==null||!((t=Object.getOwnPropertyDescriptor(s,Symbol.toStringTag))!=null&&t.writable)?!1:s.toString()===`[object ${i}]`}let e=s;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(s)===e}function us(s,...e){const t=e.slice(0,-1),i=e[e.length-1];let r=s;for(let o=0;o<t.length;o++){const a=t[o];r=me(r,a,i,new Map)}return r}function me(s,e,t,i){if(Pe(s)&&(s=Object(s)),e==null||typeof e!="object")return s;if(i.has(e))return kt(i.get(e));if(i.set(e,s),Array.isArray(e)){e=e.slice();for(let o=0;o<e.length;o++)e[o]=e[o]??void 0}const r=[...Object.keys(e),...tt(e)];for(let o=0;o<r.length;o++){const a=r[o];let c=e[a],p=s[a];if(Fe(c)&&(c={...c}),Fe(p)&&(p={...p}),typeof Buffer<"u"&&Buffer.isBuffer(c)&&(c=Be(c)),Array.isArray(c))if(typeof p=="object"&&p!=null){const y=[],_=Reflect.ownKeys(p);for(let v=0;v<_.length;v++){const P=_[v];y[P]=p[P]}p=y}else p=[];const g=t(p,c,a,s,e,i);g!=null?s[a]=g:Array.isArray(c)||xe(p)&&xe(c)?s[a]=me(p,c,t,i):p==null&&ds(c)?s[a]=me({},c,t,i):p==null&&ls(c)?s[a]=Be(c):(p===void 0||c!==void 0)&&(s[a]=c)}return s}function fs(s,...e){return us(s,...e,Lt)}var ms=Object.defineProperty,vs=Object.defineProperties,gs=Object.getOwnPropertyDescriptors,Le=Object.getOwnPropertySymbols,ys=Object.prototype.hasOwnProperty,ws=Object.prototype.propertyIsEnumerable,ke=(s,e,t)=>e in s?ms(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Z=(s,e)=>{for(var t in e||(e={}))ys.call(e,t)&&ke(s,t,e[t]);if(Le)for(var t of Le(e))ws.call(e,t)&&ke(s,t,e[t]);return s},bs=(s,e)=>vs(s,gs(e));function I(s,e,t){var i;const r=Ze(s);return((i=e.rpcMap)==null?void 0:i[r.reference])||`${et}?chainId=${r.namespace}:${r.reference}&projectId=${t}`}function q(s){return s.includes(":")?s.split(":")[1]:s}function ot(s){return s.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function Ps(s,e){const t=Object.keys(e.namespaces).filter(r=>r.includes(s));if(!t.length)return[];const i=[];return t.forEach(r=>{const o=e.namespaces[r].accounts;i.push(...o)}),i}function ce(s={},e={}){const t=ze(s),i=ze(e);return fs(t,i)}function ze(s){var e,t,i,r;const o={};if(!$t(s))return o;for(const[a,c]of Object.entries(s)){const p=Ye(a)?[a]:c.chains,g=c.methods||[],y=c.events||[],_=c.rpcMap||{},v=Q(a);o[v]=bs(Z(Z({},o[v]),c),{chains:oe(p,(e=o[v])==null?void 0:e.chains),methods:oe(g,(t=o[v])==null?void 0:t.methods),events:oe(y,(i=o[v])==null?void 0:i.events),rpcMap:Z(Z({},_),(r=o[v])==null?void 0:r.rpcMap)})}return o}function Cs(s){return s.includes(":")?s.split(":")[2]:s}function Ge(s){const e={};for(const[t,i]of Object.entries(s)){const r=i.methods||[],o=i.events||[],a=i.accounts||[],c=Ye(t)?[t]:i.chains?i.chains:ot(i.accounts);e[t]={chains:c,methods:r,events:o,accounts:a}}return e}function he(s){return typeof s=="number"?s:s.includes("0x")?parseInt(s,16):(s=s.includes(":")?s.split(":")[1]:s,isNaN(Number(s))?s:Number(s))}const ct={},u=s=>ct[s],pe=(s,e)=>{ct[s]=e};var Is=Object.defineProperty,Es=(s,e,t)=>e in s?Is(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,N=(s,e,t)=>Es(s,typeof e!="symbol"?e+"":e,t);class Os{constructor(e){N(this,"name","polkadot"),N(this,"client"),N(this,"httpProviders"),N(this,"events"),N(this,"namespace"),N(this,"chainId"),this.namespace=e.namespace,this.events=u("events"),this.client=u("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(O.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const r=q(t);e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||I(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new $(new j(i,u("disableProviderPing")))}}var As=Object.defineProperty,$s=Object.defineProperties,js=Object.getOwnPropertyDescriptors,Je=Object.getOwnPropertySymbols,_s=Object.prototype.hasOwnProperty,Hs=Object.prototype.propertyIsEnumerable,ve=(s,e,t)=>e in s?As(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ve=(s,e)=>{for(var t in e||(e={}))_s.call(e,t)&&ve(s,t,e[t]);if(Je)for(var t of Je(e))Hs.call(e,t)&&ve(s,t,e[t]);return s},Qe=(s,e)=>$s(s,js(e)),T=(s,e,t)=>ve(s,typeof e!="symbol"?e+"":e,t);class Ss{constructor(e){T(this,"name","eip155"),T(this,"client"),T(this,"chainId"),T(this,"namespace"),T(this,"httpProviders"),T(this,"events"),this.namespace=e.namespace,this.events=u("events"),this.client=u("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(O.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||I(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new $(new j(i,u("disableProviderPing")))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const r=parseInt(q(t));e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,i;let r=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";r=r.startsWith("0x")?r:`0x${r}`;const o=parseInt(r,16);if(this.isChainApproved(o))this.setDefaultChain(`${o}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:r}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${o}`);else throw new Error(`Failed to switch to chain 'eip155:${o}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,i,r;const o=(i=(t=e.request)==null?void 0:t.params)==null?void 0:i[0];if(!o)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const a=this.client.session.get(e.topic),c=((r=a==null?void 0:a.sessionProperties)==null?void 0:r.capabilities)||{};if(c!=null&&c[o])return c==null?void 0:c[o];const p=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Qe(Ve({},a.sessionProperties||{}),{capabilities:Qe(Ve({},c||{}),{[o]:p})})})}catch(g){console.warn("Failed to update session with capabilities",g)}return p}async getCallStatus(e){var t,i;const r=this.client.session.get(e.topic),o=(t=r.sessionProperties)==null?void 0:t.bundler_name;if(o){const c=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(c,e)}catch(p){console.warn("Failed to fetch call status from bundler",p,c)}}const a=(i=r.sessionProperties)==null?void 0:i.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(c){console.warn("Failed to fetch call status from custom bundler",c,a)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var i;const r=new URL(e),o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(jt("eth_getUserOperationReceipt",[(i=t.request.params)==null?void 0:i[0]]))});if(!o.ok)throw new Error(`Failed to fetch user operation receipt - ${o.status}`);return await o.json()}getBundlerUrl(e,t){return`${Ft}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}var Ds=Object.defineProperty,qs=(s,e,t)=>e in s?Ds(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,R=(s,e,t)=>qs(s,typeof e!="symbol"?e+"":e,t);class Ns{constructor(e){R(this,"name","solana"),R(this,"client"),R(this,"httpProviders"),R(this,"events"),R(this,"namespace"),R(this,"chainId"),this.namespace=e.namespace,this.events=u("events"),this.client=u("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(O.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const r=q(t);e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||I(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new $(new j(i,u("disableProviderPing")))}}var Ts=Object.defineProperty,Rs=(s,e,t)=>e in s?Ts(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,M=(s,e,t)=>Rs(s,typeof e!="symbol"?e+"":e,t);class Ms{constructor(e){M(this,"name","cosmos"),M(this,"client"),M(this,"httpProviders"),M(this,"events"),M(this,"namespace"),M(this,"chainId"),this.namespace=e.namespace,this.events=u("events"),this.client=u("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(O.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const r=q(t);e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||I(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new $(new j(i,u("disableProviderPing")))}}var Us=Object.defineProperty,xs=(s,e,t)=>e in s?Us(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,U=(s,e,t)=>xs(s,typeof e!="symbol"?e+"":e,t);class Bs{constructor(e){U(this,"name","algorand"),U(this,"client"),U(this,"httpProviders"),U(this,"events"),U(this,"namespace"),U(this,"chainId"),this.namespace=e.namespace,this.events=u("events"),this.client=u("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||I(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(O.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||I(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new $(new j(i,u("disableProviderPing")))}}var Fs=Object.defineProperty,Ls=(s,e,t)=>e in s?Fs(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,x=(s,e,t)=>Ls(s,typeof e!="symbol"?e+"":e,t);class ks{constructor(e){x(this,"name","cip34"),x(this,"client"),x(this,"httpProviders"),x(this,"events"),x(this,"namespace"),x(this,"chainId"),this.namespace=e.namespace,this.events=u("events"),this.client=u("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(O.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t),r=q(t);e[r]=this.createHttpProvider(r,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new $(new j(i,u("disableProviderPing")))}}var zs=Object.defineProperty,Gs=(s,e,t)=>e in s?zs(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,B=(s,e,t)=>Gs(s,typeof e!="symbol"?e+"":e,t);class Js{constructor(e){B(this,"name","elrond"),B(this,"client"),B(this,"httpProviders"),B(this,"events"),B(this,"namespace"),B(this,"chainId"),this.namespace=e.namespace,this.events=u("events"),this.client=u("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(O.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const r=q(t);e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||I(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new $(new j(i,u("disableProviderPing")))}}var Vs=Object.defineProperty,Qs=(s,e,t)=>e in s?Vs(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,F=(s,e,t)=>Qs(s,typeof e!="symbol"?e+"":e,t);class Ws{constructor(e){F(this,"name","multiversx"),F(this,"client"),F(this,"httpProviders"),F(this,"events"),F(this,"namespace"),F(this,"chainId"),this.namespace=e.namespace,this.events=u("events"),this.client=u("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(O.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const r=q(t);e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||I(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new $(new j(i,u("disableProviderPing")))}}var Ks=Object.defineProperty,Xs=(s,e,t)=>e in s?Ks(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,L=(s,e,t)=>Xs(s,typeof e!="symbol"?e+"":e,t);class Ys{constructor(e){L(this,"name","near"),L(this,"client"),L(this,"httpProviders"),L(this,"events"),L(this,"namespace"),L(this,"chainId"),this.namespace=e.namespace,this.events=u("events"),this.client=u("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||I(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(O.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||I(e,this.namespace);return typeof i>"u"?void 0:new $(new j(i,u("disableProviderPing")))}}var Zs=Object.defineProperty,ei=(s,e,t)=>e in s?Zs(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,k=(s,e,t)=>ei(s,typeof e!="symbol"?e+"":e,t);class ti{constructor(e){k(this,"name","tezos"),k(this,"client"),k(this,"httpProviders"),k(this,"events"),k(this,"namespace"),k(this,"chainId"),this.namespace=e.namespace,this.events=u("events"),this.client=u("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||I(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(O.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||I(e,this.namespace);return typeof i>"u"?void 0:new $(new j(i))}}var si=Object.defineProperty,ii=(s,e,t)=>e in s?si(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,z=(s,e,t)=>ii(s,typeof e!="symbol"?e+"":e,t);class ri{constructor(e){z(this,"name",G),z(this,"client"),z(this,"httpProviders"),z(this,"events"),z(this,"namespace"),z(this,"chainId"),this.namespace=e.namespace,this.events=u("events"),this.client=u("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(O.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const i={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(r=>{const o=Ze(r);i[`${o.namespace}:${o.reference}`]=this.createHttpProvider(r)}),i}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||I(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new $(new j(i,u("disableProviderPing")))}}var ni=Object.defineProperty,ai=Object.defineProperties,oi=Object.getOwnPropertyDescriptors,We=Object.getOwnPropertySymbols,ci=Object.prototype.hasOwnProperty,hi=Object.prototype.propertyIsEnumerable,ge=(s,e,t)=>e in s?ni(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ee=(s,e)=>{for(var t in e||(e={}))ci.call(e,t)&&ge(s,t,e[t]);if(We)for(var t of We(e))hi.call(e,t)&&ge(s,t,e[t]);return s},le=(s,e)=>ai(s,oi(e)),E=(s,e,t)=>ge(s,typeof e!="symbol"?e+"":e,t);let pi=class ht{constructor(e){E(this,"client"),E(this,"namespaces"),E(this,"optionalNamespaces"),E(this,"sessionProperties"),E(this,"scopedProperties"),E(this,"events",new Ct),E(this,"rpcProviders",{}),E(this,"session"),E(this,"providerOpts"),E(this,"logger"),E(this,"uri"),E(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:It(Et({level:(e==null?void 0:e.logger)||Ue})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const t=new ht(e);return await t.initialize(),t}async request(e,t,i){const[r,o]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(r).request({request:ee({},e),chainId:`${r}:${o}`,topic:this.session.topic,expiry:i})}sendAsync(e,t,i,r){const o=new Date().getTime();this.request(e,i,r).then(a=>t(null,Ot(o,a))).catch(a=>t(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ue("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:r}=await this.client.authenticate(e,t);i&&(this.uri=i,this.events.emit("display_uri",i));const o=await r();if(this.session=o.session,this.session){const a=Ge(this.session.namespaces);this.namespaces=ce(this.namespaces,a),await this.persist("namespaces",this.namespaces),this.onConnect()}return o}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const r=await i();this.session=r;const o=Ge(r.namespaces);return this.namespaces=ce(this.namespaces,o),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[i,r]=this.validateChain(e),o=this.getProvider(i);o.name===G?o.setDefaultChain(`${i}:${r}`,t):o.setDefaultChain(r,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(W(t)){for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await At.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Ue,relayUrl:this.providerOpts.relayUrl||Ut,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error("Failed to get session",i),new Error(`The provided session: ${(t=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:t.topic} doesn't exist in the Sign client`)}else{const i=this.client.session.getAll();this.session=i[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>Q(t)))];pe("client",this.client),pe("events",this.events),pe("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const i=Ps(t,this.session),r=ot(i),o=ce(this.namespaces,this.optionalNamespaces),a=le(ee({},o[t]),{accounts:i,chains:r});switch(t){case"eip155":this.rpcProviders[t]=new Ss({namespace:a});break;case"algorand":this.rpcProviders[t]=new Bs({namespace:a});break;case"solana":this.rpcProviders[t]=new Ns({namespace:a});break;case"cosmos":this.rpcProviders[t]=new Ms({namespace:a});break;case"polkadot":this.rpcProviders[t]=new Os({namespace:a});break;case"cip34":this.rpcProviders[t]=new ks({namespace:a});break;case"elrond":this.rpcProviders[t]=new Js({namespace:a});break;case"multiversx":this.rpcProviders[t]=new Ws({namespace:a});break;case"near":this.rpcProviders[t]=new Ys({namespace:a});break;case"tezos":this.rpcProviders[t]=new ti({namespace:a});break;default:this.rpcProviders[G]?this.rpcProviders[G].updateNamespace(a):this.rpcProviders[G]=new ri({namespace:a})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;const{topic:i}=e;i===((t=this.session)==null?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;const{params:i,topic:r}=e;if(r!==((t=this.session)==null?void 0:t.topic))return;const{event:o}=i;if(o.name==="accountsChanged"){const a=o.data;a&&W(a)&&this.events.emit("accountsChanged",a.map(Cs))}else if(o.name==="chainChanged"){const a=i.chainId,c=i.event.data,p=Q(a),g=he(a)!==he(c)?`${p}:${he(c)}`:a;this.onChainChanged(g)}else this.events.emit(o.name,o.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i,r;if(e!==((i=this.session)==null?void 0:i.topic))return;const{namespaces:o}=t,a=(r=this.client)==null?void 0:r.session.get(e);this.session=le(ee({},a),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===((t=this.session)==null?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",le(ee({},ue("USER_DISCONNECTED")),{data:e.topic})))}),this.on(O.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[G]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:i,sessionProperties:r,scopedProperties:o}=e;t&&Object.keys(t).length&&(this.namespaces=t),i&&Object.keys(i).length&&(this.optionalNamespaces=i),this.sessionProperties=r,this.scopedProperties=o}validateChain(e){const[t,i]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(a=>Q(a)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&i)return[t,i];const r=Q(Object.keys(this.namespaces)[0]),o=this.rpcProviders[r].getDefaultChain();return[r,o]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,t=!1){if(!this.namespaces)return;const[i,r]=this.validateChain(e);r&&(t||this.getProvider(i).setDefaultChain(r),this.namespaces[i]?this.namespaces[i].defaultChain=r:this.namespaces[`${i}:${r}`]?this.namespaces[`${i}:${r}`].defaultChain=r:this.namespaces[`${i}:${r}`]={defaultChain:r},this.events.emit("chainChanged",r),await this.persist("namespaces",this.namespaces))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var i;const r=((i=this.session)==null?void 0:i.topic)||"";await this.client.core.storage.setItem(`${Y}/${e}${r}`,t)}async getFromStore(e){var t;const i=((t=this.session)==null?void 0:t.topic)||"";return await this.client.core.storage.getItem(`${Y}/${e}${i}`)}async deleteFromStore(e){var t;const i=((t=this.session)==null?void 0:t.topic)||"";await this.client.core.storage.removeItem(`${Y}/${e}${i}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const t=await this.client.core.storage.getKeys();for(const i of t)i.startsWith(Y)&&await this.client.core.storage.removeItem(i)}catch(t){this.logger.warn("Failed to cleanup storage",t)}}};const li=pi,di="wc",ui="ethereum_provider",fi=`${di}@2:${ui}:`,mi="https://rpc.walletconnect.org/v1/",ye=["eth_sendTransaction","personal_sign"],vi=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],we=["chainChanged","accountsChanged"],gi=["chainChanged","accountsChanged","message","disconnect","connect"];var yi=Object.defineProperty,wi=Object.defineProperties,bi=Object.getOwnPropertyDescriptors,Ke=Object.getOwnPropertySymbols,Pi=Object.prototype.hasOwnProperty,Ci=Object.prototype.propertyIsEnumerable,be=(s,e,t)=>e in s?yi(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,J=(s,e)=>{for(var t in e||(e={}))Pi.call(e,t)&&be(s,t,e[t]);if(Ke)for(var t of Ke(e))Ci.call(e,t)&&be(s,t,e[t]);return s},de=(s,e)=>wi(s,bi(e)),C=(s,e,t)=>be(s,typeof e!="symbol"?e+"":e,t);function se(s){return Number(s[0].split(":")[1])}function te(s){return`0x${s.toString(16)}`}function Ii(s){const{chains:e,optionalChains:t,methods:i,optionalMethods:r,events:o,optionalEvents:a,rpcMap:c}=s;if(!W(e))throw new Error("Invalid chains");const p={chains:e,methods:i||ye,events:o||we,rpcMap:J({},e.length?{[se(e)]:c[se(e)]}:{})},g=o==null?void 0:o.filter(P=>!we.includes(P)),y=i==null?void 0:i.filter(P=>!ye.includes(P));if(!t&&!a&&!r&&!(g!=null&&g.length)&&!(y!=null&&y.length))return{required:e.length?p:void 0};const _=(g==null?void 0:g.length)&&(y==null?void 0:y.length)||!t,v={chains:[...new Set(_?p.chains.concat(t||[]):t)],methods:[...new Set(p.methods.concat(r!=null&&r.length?r:vi))],events:[...new Set(p.events.concat(a!=null&&a.length?a:gi))],rpcMap:c};return{required:e.length?p:void 0,optional:t.length?v:void 0}}class Ie{constructor(){C(this,"events",new Xe.EventEmitter),C(this,"namespace","eip155"),C(this,"accounts",[]),C(this,"signer"),C(this,"chainId",1),C(this,"modal"),C(this,"rpc"),C(this,"STORAGE_KEY",fi),C(this,"on",(e,t)=>(this.events.on(e,t),this)),C(this,"once",(e,t)=>(this.events.once(e,t),this)),C(this,"removeListener",(e,t)=>(this.events.removeListener(e,t),this)),C(this,"off",(e,t)=>(this.events.off(e,t),this)),C(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const t=new Ie;return await t.initialize(e),t}async request(e,t){return await this.signer.request(e,this.formatChainId(this.chainId),t)}sendAsync(e,t,i){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),i)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:t,optional:i}=Ii(this.rpc);try{const r=await new Promise(async(a,c)=>{var p;this.rpc.showQrModal&&((p=this.modal)==null||p.subscribeModal(y=>{!y.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const g=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(de(J({namespaces:J({},t&&{[this.namespace]:t})},i&&{optionalNamespaces:{[this.namespace]:i}}),{pairingTopic:e==null?void 0:e.pairingTopic,scopedProperties:g})).then(y=>{a(y)}).catch(y=>{c(new Error(y.message))})});if(!r)return;const o=He(r.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:te(this.chainId)})}catch(r){throw this.signer.logger.error(r),r}finally{this.modal&&this.modal.closeModal()}}async authenticate(e,t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e==null?void 0:e.chains});try{const i=await new Promise(async(o,a)=>{var c;this.rpc.showQrModal&&((c=this.modal)==null||c.subscribeModal(p=>{!p.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(de(J({},e),{chains:this.rpc.chains}),t).then(p=>{o(p)}).catch(p=>{a(new Error(p.message))})}),r=i.session;if(r){const o=He(r.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:te(this.chainId)})}return i}catch(i){throw this.signer.logger.error(i),i}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:i}=t;i.name==="accountsChanged"?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",te(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",de(J({},ue("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{var t,i;this.rpc.showQrModal&&((t=this.modal)==null||t.closeModal(),(i=this.modal)==null||i.openModal({uri:e})),this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",te(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){const[t,i,r]=e.split(":");return{chainId:`${t}:${i}`,address:r}}setAccounts(e){this.accounts=e.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,i;const r=(t=e==null?void 0:e.chains)!=null?t:[],o=(i=e==null?void 0:e.optionalChains)!=null?i:[],a=r.concat(o);if(!a.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const c=r.length?(e==null?void 0:e.methods)||ye:[],p=r.length?(e==null?void 0:e.events)||we:[],g=(e==null?void 0:e.optionalMethods)||[],y=(e==null?void 0:e.optionalEvents)||[],_=(e==null?void 0:e.rpcMap)||this.buildRpcMap(a,e.projectId),v=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:r==null?void 0:r.map(P=>this.formatChainId(P)),optionalChains:o.map(P=>this.formatChainId(P)),methods:c,events:p,optionalMethods:g,optionalEvents:y,rpcMap:_,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:v,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const i={};return e.forEach(r=>{i[r]=this.getRpcUrl(r,t)}),i}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?se(this.rpc.chains):se(this.rpc.optionalChains),this.signer=await li.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const{WalletConnectModal:i}=await _t(()=>import("./index-f2f66cf5.js").then(r=>r.i),["assets/index-f2f66cf5.js","assets/index-a005ad49.js","assets/index-fae58ef4.css"]);t=i}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(t)try{this.modal=new t(J({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(i){throw this.signer.logger.error(i),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:i,rpcMap:r}=e;t&&W(t)&&(this.rpc.chains=t.map(o=>this.formatChainId(o)),t.forEach(o=>{this.rpc.rpcMap[o]=(r==null?void 0:r[o])||this.getRpcUrl(o)})),i&&W(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i==null?void 0:i.map(o=>this.formatChainId(o)),i.forEach(o=>{this.rpc.rpcMap[o]=(r==null?void 0:r[o])||this.getRpcUrl(o)}))}getRpcUrl(e,t){var i;return((i=this.rpc.rpcMap)==null?void 0:i[e])||`${mi}?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:t==null?void 0:t.accounts),this.setAccounts(t==null?void 0:t.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(t=>this.signer.logger.warn(t))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(t=>this.parseAccount(t))}}const Oi=Ie;export{Oi as EthereumProvider,gi as OPTIONAL_EVENTS,vi as OPTIONAL_METHODS,we as REQUIRED_EVENTS,ye as REQUIRED_METHODS,Ie as default};
